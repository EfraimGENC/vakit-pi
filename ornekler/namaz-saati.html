<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Namaz Vakitleri</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        .amiri { font-family: 'Amiri', serif; }
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 50%, #1b263b 100%);
        }
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .active-prayer {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(34, 197, 94, 0.3); }
            50% { box-shadow: 0 0 40px rgba(34, 197, 94, 0.6); }
        }
        .switch {
            position: relative;
            width: 48px;
            height: 26px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background-color: #374151;
            transition: .3s;
            border-radius: 26px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #22c55e;
        }
        input:checked + .slider:before {
            transform: translateX(22px);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <div id="app"></div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                // State
                const currentTab = ref('home');
                const currentTime = ref(new Date());
                const location = ref({ lat: null, lng: null, city: 'Konum alƒ±nƒ±yor...' });
                const locationError = ref(null);
                const prayerTimes = ref({
                    imsak: '05:45',
                    gunes: '07:15',
                    ogle: '12:30',
                    ikindi: '15:15',
                    aksam: '17:45',
                    yatsi: '19:15'
                });

                // Ayarlar
                const settings = ref({
                    soundEnabled: {
                        imsak: true,
                        gunes: false,
                        ogle: true,
                        ikindi: true,
                        aksam: true,
                        yatsi: true
                    },
                    adhanType: 'makkah', // makkah, madinah, istanbul
                    preAlertMinutes: 15,
                    volume: 80,
                    darkMode: true,
                    hijriDate: true,
                    notifications: true,
                    autoLocation: true,
                    manualCity: '',
                    calculationMethod: 'turkey' // turkey, mwl, isna, egypt
                });

                const prayerNames = {
                    imsak: 'ƒ∞msak',
                    gunes: 'G√ºne≈ü',
                    ogle: '√ñƒüle',
                    ikindi: 'ƒ∞kindi',
                    aksam: 'Ak≈üam',
                    yatsi: 'Yatsƒ±'
                };

                const prayerIcons = {
                    imsak: 'üåô',
                    gunes: 'üåÖ',
                    ogle: '‚òÄÔ∏è',
                    ikindi: 'üå§Ô∏è',
                    aksam: 'üåá',
                    yatsi: 'üåÉ'
                };

                const adhanTypes = [
                    { value: 'makkah', label: 'Mekke Ezanƒ±' },
                    { value: 'madinah', label: 'Medine Ezanƒ±' },
                    { value: 'istanbul', label: 'ƒ∞stanbul Ezanƒ±' }
                ];

                const calculationMethods = [
                    { value: 'turkey', label: 'Diyanet (T√ºrkiye)' },
                    { value: 'mwl', label: 'Muslim World League' },
                    { value: 'isna', label: 'ISNA (Kuzey Amerika)' },
                    { value: 'egypt', label: 'Mƒ±sƒ±r' }
                ];

                // Computed
                const formattedTime = computed(() => {
                    return currentTime.value.toLocaleTimeString('tr-TR', {
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                });

                const formattedDate = computed(() => {
                    return currentTime.value.toLocaleDateString('tr-TR', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                });

                const hijriDateStr = computed(() => {
                    // Basit Hicri tarih hesaplama (yakla≈üƒ±k)
                    const gregorian = currentTime.value;
                    const jd = Math.floor((gregorian.getTime() / 86400000) + 2440587.5);
                    const l = jd - 1948440 + 10632;
                    const n = Math.floor((l - 1) / 10631);
                    const l2 = l - 10631 * n + 354;
                    const j = Math.floor((10985 - l2) / 5316) * Math.floor((50 * l2) / 17719) + 
                              Math.floor(l2 / 5670) * Math.floor((43 * l2) / 15238);
                    const l3 = l2 - Math.floor((30 - j) / 15) * Math.floor((17719 * j) / 50) - 
                               Math.floor(j / 16) * Math.floor((15238 * j) / 43) + 29;
                    const month = Math.floor((24 * l3) / 709);
                    const day = l3 - Math.floor((709 * month) / 24);
                    const year = 30 * n + j - 30;
                    
                    const months = ['Muharrem', 'Safer', 'Rebi√ºlevvel', 'Rebi√ºlahir', 
                                   'Cemaziyelevvel', 'Cemaziyelahir', 'Recep', '≈ûaban',
                                   'Ramazan', '≈ûevval', 'Zilkade', 'Zilhicce'];
                    return `${day} ${months[month - 1]} ${year}`;
                });

                const currentPrayer = computed(() => {
                    const now = currentTime.value;
                    const nowMinutes = now.getHours() * 60 + now.getMinutes();
                    
                    const prayers = Object.entries(prayerTimes.value).map(([key, time]) => {
                        const [h, m] = time.split(':').map(Number);
                        return { key, minutes: h * 60 + m };
                    });
                    
                    for (let i = prayers.length - 1; i >= 0; i--) {
                        if (nowMinutes >= prayers[i].minutes) {
                            return prayers[i].key;
                        }
                    }
                    return 'yatsi'; // Gece yarƒ±sƒ±ndan sonra
                });

                const nextPrayer = computed(() => {
                    const now = currentTime.value;
                    const nowMinutes = now.getHours() * 60 + now.getMinutes();
                    
                    const prayers = Object.entries(prayerTimes.value).map(([key, time]) => {
                        const [h, m] = time.split(':').map(Number);
                        return { key, minutes: h * 60 + m, time };
                    });
                    
                    for (const prayer of prayers) {
                        if (nowMinutes < prayer.minutes) {
                            return prayer;
                        }
                    }
                    return { ...prayers[0], tomorrow: true };
                });

                const countdown = computed(() => {
                    const now = currentTime.value;
                    const nowMinutes = now.getHours() * 60 + now.getMinutes();
                    const nowSeconds = nowMinutes * 60 + now.getSeconds();
                    
                    let targetMinutes = nextPrayer.value.minutes;
                    if (nextPrayer.value.tomorrow) {
                        targetMinutes += 24 * 60;
                    }
                    const targetSeconds = targetMinutes * 60;
                    
                    const diff = targetSeconds - nowSeconds;
                    const hours = Math.floor(diff / 3600);
                    const mins = Math.floor((diff % 3600) / 60);
                    const secs = diff % 60;
                    
                    return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                });

                // Methods
                const getLocation = () => {
                    if (!navigator.geolocation) {
                        locationError.value = 'Tarayƒ±cƒ±nƒ±z konum desteƒüi sunmuyor';
                        return;
                    }

                    navigator.geolocation.getCurrentPosition(
                        async (position) => {
                            location.value.lat = position.coords.latitude;
                            location.value.lng = position.coords.longitude;
                            
                            // Reverse geocoding (basit)
                            try {
                                const response = await fetch(
                                    `https://nominatim.openstreetmap.org/reverse?lat=${position.coords.latitude}&lon=${position.coords.longitude}&format=json`
                                );
                                const data = await response.json();
                                location.value.city = data.address?.city || 
                                                     data.address?.town || 
                                                     data.address?.province ||
                                                     'Bilinmeyen Konum';
                            } catch (e) {
                                location.value.city = `${position.coords.latitude.toFixed(2)}, ${position.coords.longitude.toFixed(2)}`;
                            }
                            
                            calculatePrayerTimes();
                        },
                        (error) => {
                            locationError.value = 'Konum alƒ±namadƒ±: ' + error.message;
                            location.value.city = 'Konum alƒ±namadƒ±';
                        },
                        { enableHighAccuracy: true }
                    );
                };

                const calculatePrayerTimes = () => {
                    // Ger√ßek uygulamada API'den √ßekilir
                    // ≈ûimdilik √∂rnek saatler
                    if (location.value.lat && location.value.lng) {
                        // Basit hesaplama sim√ºlasyonu
                        const baseHour = 5 + Math.floor(Math.abs(location.value.lat) / 15);
                        prayerTimes.value = {
                            imsak: `0${baseHour}:${30 + Math.floor(Math.random() * 20)}`.slice(-5),
                            gunes: `0${baseHour + 1}:${10 + Math.floor(Math.random() * 20)}`.slice(-5),
                            ogle: `12:${25 + Math.floor(Math.random() * 15)}`,
                            ikindi: `15:${10 + Math.floor(Math.random() * 20)}`,
                            aksam: `17:${40 + Math.floor(Math.random() * 15)}`,
                            yatsi: `19:${10 + Math.floor(Math.random() * 20)}`
                        };
                    }
                };

                const toggleSound = (prayer) => {
                    settings.value.soundEnabled[prayer] = !settings.value.soundEnabled[prayer];
                    saveSettings();
                };

                const saveSettings = () => {
                    localStorage.setItem('namazSettings', JSON.stringify(settings.value));
                };

                const loadSettings = () => {
                    const saved = localStorage.getItem('namazSettings');
                    if (saved) {
                        settings.value = { ...settings.value, ...JSON.parse(saved) };
                    }
                };

                const testSound = () => {
                    // Ses testi i√ßin basit bir beep
                    const ctx = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = ctx.createOscillator();
                    const gain = ctx.createGain();
                    
                    oscillator.connect(gain);
                    gain.connect(ctx.destination);
                    
                    oscillator.frequency.value = 440;
                    gain.gain.value = settings.value.volume / 100;
                    
                    oscillator.start();
                    setTimeout(() => oscillator.stop(), 500);
                };

                // Lifecycle
                onMounted(() => {
                    loadSettings();
                    
                    if (settings.value.autoLocation) {
                        getLocation();
                    }
                    
                    // Saat g√ºncellemesi
                    setInterval(() => {
                        currentTime.value = new Date();
                    }, 1000);
                });

                // Watch settings changes
                watch(settings, saveSettings, { deep: true });

                return {
                    currentTab,
                    currentTime,
                    location,
                    locationError,
                    prayerTimes,
                    settings,
                    prayerNames,
                    prayerIcons,
                    adhanTypes,
                    calculationMethods,
                    formattedTime,
                    formattedDate,
                    hijriDateStr,
                    currentPrayer,
                    nextPrayer,
                    countdown,
                    getLocation,
                    toggleSound,
                    testSound,
                    saveSettings
                };
            },
            template: `
                <div class="min-h-screen pb-20">
                    <!-- Header -->
                    <div class="text-center pt-8 pb-4 px-4">
                        <p class="text-emerald-400 text-sm">{{ location.city }}</p>
                        <h1 class="amiri text-5xl font-bold mt-2">{{ formattedTime }}</h1>
                        <p class="text-gray-400 mt-1">{{ formattedDate }}</p>
                        <p v-if="settings.hijriDate" class="text-amber-400 text-sm amiri mt-1">{{ hijriDateStr }}</p>
                    </div>

                    <!-- Ana Sayfa -->
                    <div v-if="currentTab === 'home'" class="px-4">
                        <!-- Sonraki Namaz Kartƒ± -->
                        <div class="glass rounded-2xl p-6 mb-6 text-center">
                            <p class="text-gray-400 text-sm">Sonraki Namaz</p>
                            <div class="flex items-center justify-center gap-3 mt-2">
                                <span class="text-3xl">{{ prayerIcons[nextPrayer.key] }}</span>
                                <span class="text-2xl font-semibold">{{ prayerNames[nextPrayer.key] }}</span>
                            </div>
                            <p class="text-4xl font-bold text-emerald-400 mt-2">{{ nextPrayer.time }}</p>
                            <div class="mt-4 bg-black/30 rounded-xl py-3 px-4">
                                <p class="text-gray-400 text-xs">Kalan S√ºre</p>
                                <p class="text-2xl font-mono text-white">{{ countdown }}</p>
                            </div>
                        </div>

                        <!-- Namaz Vakitleri Listesi -->
                        <div class="glass rounded-2xl overflow-hidden">
                            <div v-for="(time, key) in prayerTimes" :key="key"
                                 :class="[
                                     'flex items-center justify-between p-4 border-b border-white/5 last:border-0',
                                     currentPrayer === key ? 'active-prayer bg-emerald-500/10' : ''
                                 ]">
                                <div class="flex items-center gap-3">
                                    <span class="text-2xl">{{ prayerIcons[key] }}</span>
                                    <div>
                                        <p class="font-medium">{{ prayerNames[key] }}</p>
                                        <p v-if="settings.soundEnabled[key]" class="text-xs text-emerald-400">üîî Sesli</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-xl font-semibold">{{ time }}</p>
                                    <p v-if="currentPrayer === key" class="text-xs text-emerald-400">≈ûu anki vakit</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ayarlar -->
                    <div v-if="currentTab === 'settings'" class="px-4">
                        <h2 class="text-xl font-semibold mb-4">‚öôÔ∏è Ayarlar</h2>

                        <!-- Konum Ayarlarƒ± -->
                        <div class="glass rounded-2xl p-4 mb-4">
                            <h3 class="font-medium text-emerald-400 mb-3">üìç Konum</h3>
                            
                            <div class="flex items-center justify-between mb-4">
                                <span>Otomatik Konum</span>
                                <label class="switch">
                                    <input type="checkbox" v-model="settings.autoLocation" @change="settings.autoLocation && getLocation()">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <button @click="getLocation" 
                                    class="w-full bg-emerald-600 hover:bg-emerald-700 rounded-xl py-3 font-medium transition">
                                üîÑ Konumu G√ºncelle
                            </button>
                            
                            <p v-if="location.lat" class="text-xs text-gray-400 mt-2 text-center">
                                {{ location.lat?.toFixed(4) }}, {{ location.lng?.toFixed(4) }}
                            </p>
                            <p v-if="locationError" class="text-xs text-red-400 mt-2">{{ locationError }}</p>
                        </div>

                        <!-- Ezan Ayarlarƒ± -->
                        <div class="glass rounded-2xl p-4 mb-4">
                            <h3 class="font-medium text-emerald-400 mb-3">üîä Ezan Ayarlarƒ±</h3>
                            
                            <div class="mb-4">
                                <label class="text-sm text-gray-400 block mb-2">Ezan T√ºr√º</label>
                                <select v-model="settings.adhanType" 
                                        class="w-full bg-white/10 rounded-xl py-3 px-4 border border-white/10 focus:border-emerald-500 outline-none">
                                    <option v-for="type in adhanTypes" :key="type.value" :value="type.value">
                                        {{ type.label }}
                                    </option>
                                </select>
                            </div>
                            
                            <div class="mb-4">
                                <label class="text-sm text-gray-400 block mb-2">Ses Seviyesi: {{ settings.volume }}%</label>
                                <input type="range" v-model="settings.volume" min="0" max="100" 
                                       class="w-full accent-emerald-500">
                            </div>
                            
                            <button @click="testSound" 
                                    class="w-full bg-gray-700 hover:bg-gray-600 rounded-xl py-2 text-sm transition">
                                üîà Ses Testi
                            </button>
                        </div>

                        <!-- Vakit Bildirimleri -->
                        <div class="glass rounded-2xl p-4 mb-4">
                            <h3 class="font-medium text-emerald-400 mb-3">üîî Sesli Okunacak Vakitler</h3>
                            
                            <div v-for="(enabled, key) in settings.soundEnabled" :key="key"
                                 class="flex items-center justify-between py-3 border-b border-white/5 last:border-0">
                                <div class="flex items-center gap-2">
                                    <span>{{ prayerIcons[key] }}</span>
                                    <span>{{ prayerNames[key] }}</span>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" v-model="settings.soundEnabled[key]">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <!-- √ñn Uyarƒ± -->
                        <div class="glass rounded-2xl p-4 mb-4">
                            <h3 class="font-medium text-emerald-400 mb-3">‚è∞ √ñn Uyarƒ±</h3>
                            
                            <div class="mb-2">
                                <label class="text-sm text-gray-400 block mb-2">
                                    Vakitten {{ settings.preAlertMinutes }} dakika √∂nce uyar
                                </label>
                                <input type="range" v-model="settings.preAlertMinutes" min="0" max="30" step="5"
                                       class="w-full accent-emerald-500">
                            </div>
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>Kapalƒ±</span>
                                <span>15 dk</span>
                                <span>30 dk</span>
                            </div>
                        </div>

                        <!-- Hesaplama Y√∂ntemi -->
                        <div class="glass rounded-2xl p-4 mb-4">
                            <h3 class="font-medium text-emerald-400 mb-3">üìê Hesaplama Y√∂ntemi</h3>
                            
                            <select v-model="settings.calculationMethod" 
                                    class="w-full bg-white/10 rounded-xl py-3 px-4 border border-white/10 focus:border-emerald-500 outline-none">
                                <option v-for="method in calculationMethods" :key="method.value" :value="method.value">
                                    {{ method.label }}
                                </option>
                            </select>
                        </div>

                        <!-- Diƒüer Ayarlar -->
                        <div class="glass rounded-2xl p-4 mb-4">
                            <h3 class="font-medium text-emerald-400 mb-3">üé® G√∂r√ºn√ºm</h3>
                            
                            <div class="flex items-center justify-between py-3 border-b border-white/5">
                                <span>Hicri Tarihi G√∂ster</span>
                                <label class="switch">
                                    <input type="checkbox" v-model="settings.hijriDate">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <div class="flex items-center justify-between py-3">
                                <span>Bildirimler</span>
                                <label class="switch">
                                    <input type="checkbox" v-model="settings.notifications">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Bottom Navigation -->
                    <nav class="fixed bottom-0 left-0 right-0 glass border-t border-white/10">
                        <div class="flex justify-around py-3">
                            <button @click="currentTab = 'home'" 
                                    :class="['flex flex-col items-center gap-1 px-6 py-2 rounded-xl transition',
                                             currentTab === 'home' ? 'text-emerald-400' : 'text-gray-400']">
                                <span class="text-xl">üïå</span>
                                <span class="text-xs">Vakitler</span>
                            </button>
                            <button @click="currentTab = 'settings'" 
                                    :class="['flex flex-col items-center gap-1 px-6 py-2 rounded-xl transition',
                                             currentTab === 'settings' ? 'text-emerald-400' : 'text-gray-400']">
                                <span class="text-xl">‚öôÔ∏è</span>
                                <span class="text-xs">Ayarlar</span>
                            </button>
                        </div>
                    </nav>
                </div>
            `
        }).mount('#app');
    </script>
</body>
</html>
